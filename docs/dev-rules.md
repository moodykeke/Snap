# Snap! 二次开发规则与约束（moodykeke）

## 总体原则
- 与上游保持同步，尽量避免直接修改核心文件；优先使用扩展机制（`Extensions.md`）。
- 变更尽量“最小侵入”，所有 UI/功能改动需自测并可回滚。

## 代码风格与结构
- 语言：原仓库以原生 JS/HTML 为主，不引入打包器或框架（除非明确必要）。
- 语法：兼容 ES5/ES6；保持与现有风格一致（函数原型与闭包较多）。
- 文件：按上游目录组织；扩展/新增模块放入 `libraries/` 或独立 JS 文件，并在 `snap.html`/加载入口中按需引入。
- 格式：缩进 4 空格；单引号优先；避免行尾逗号；遵循 `.editorconfig`。

## 语法/使用限制
- 禁止 `eval` 与修改内置原型；避免将变量泄露到全局作用域。
- 交互遵循 Morphic 组件规范；避免直接操作 DOM 未经 Snap! 封装的元素。
- 网络/存储遵循 PWA 与安全策略；如需外部库，使用 CDN 并提供离线兜底。

## 扩展开发（参考：Extensions.md）
- 新积木通过扩展 API 注册：定义分类、选择器、输入槽、执行逻辑。
- 不破坏现有积木语义；新增功能必须明确类型（报告、命令、谓词）。
- 资源加载需与离线模式兼容；避免阻塞 UI 线程。

## 提交规范（Conventional Commits 精简版）
- `feat:` 新功能；`fix:` 缺陷修复；`docs:` 文档；`chore:` 维护/规则/工作流。
- 提交信息遵循 `.gitmessage.txt` 模板，附上计划/Issue 链接。

## 分支与合并
- 命名：`feature/<name>`、`fix/<name>`、`docs/<name>`。
- 同步上游：在合并前 `git fetch upstream && git rebase upstream/master` 或快进合并。
- PR 检查项：规则遵循、风险评估、验收与自测、截图/演示（如有）。

## 性能与安全
- 避免长任务阻塞；必要时使用异步与批处理。
- 对外输入做校验与最小化信任；不引入不必要权限。