# 需求计划：多语言自动化工具（i18n audit & assist）

## 背景
Snap! 采用 `Localizer` + `SnapTranslator.dict` 的字典式翻译：
- 英文基准字典在 `src/locale.js` 的 `SnapTranslator.dict.en`。
- 其他语言既在 `src/locale.js` 内置，又可在 `locale/lang-*.js` 以展开赋值方式增量覆盖。
- 翻译查找为“键值直映射 + 语境化（contextualize）”。空字符串或缺失时回退到英文。

## 目标 / 验收标准
- [ ] 自动聚合英文与所有语言字典，统计缺失键与占位符差异。
- [ ] 输出报告（JSON/Markdown），包含每种语言的缺失总数与明细。
- [ ] 可生成 overlay 的 stub 文件（按需），便于补齐缺失键。
- [ ] 不引入运行期依赖；仅作为开发工具，最小侵入。

## 范围与影响
- 只读 `src/locale.js` 与 `locale/` 下语言文件；不改动核心运行逻辑。
- 新增 `utilities/i18n/` 工具脚本与文档。

## 风险与回滚方案
- 若解析失败或环境缺少 Node.js，工具不运行，不影响产品功能。
- 所有改动均在独立分支；必要时直接回滚分支或删除工具目录。

## 开发步骤
- 聚合：使用 Node `vm` 在沙箱中执行 `src/locale.js` 与 `locale/lang-*.js`，得到 `SnapTranslator.dict`。
- 统计：以 `en` 为基，过滤 meta 键，识别每语言缺失项与"值==英文"项。
- 占位符校验：统计英文与目标值中的 `_`、`<#n>` 等占位符数量差异。
- 报告：写入 `utilities/i18n/report-YYYYMMDD.json`（与可选 Markdown）。
- Stub 生成：按需输出 `locale/lang-<code>.js` 格式的缺失键骨架。

## 自测清单
- [ ] 在 Windows 下可运行 `node utilities/i18n/audit.js`。
- [ ] 输出报告包含 `zh_CN`、`de` 等语言的统计。
- [ ] Stub 文件生成正确、可被上游加载逻辑接受（对象展开合并）。

## 里程碑与时间
- 初版工具与报告：当天完成。
- 增强：添加代码扫描 `localize('...')` 的键补充（次迭代）。